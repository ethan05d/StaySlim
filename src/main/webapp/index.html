<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StaySlim (Prototype)</title>
  <style>
    :root {
      --accent: #3b82f6;
      --accent-light: #bfdbfe;
      --bg: #f3f4f6;
      --card: #ffffff;
      --text: #1f2937;
      --warning: #f97316;
      --danger: #ef4444;
      --success: #10b981;
    }
    * { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
    body { margin:0; background:var(--bg); color:var(--text); min-height:100vh; display:flex; flex-direction:column; }
    nav { background:var(--accent); color:#fff; padding:1rem 2rem; display:flex; gap:1rem; align-items:center; }
    nav button { background:transparent; border:none; color:inherit; font-weight:bold; cursor:pointer; }
    .brand { font-weight:900; margin-right:1rem; }
    .auth { display:none; }
    h1 { margin-top:0; }
    .container { width:100%; max-width:850px; margin:1.5rem auto; background:var(--card); padding:2rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.05); }
    input[type="text"], input[type="email"], input[type="password"], input[type="number"], input[type="date"] { width:100%; padding:.6rem .75rem; margin:.25rem 0 1rem; border:1px solid #d1d5db; border-radius:8px; }
    button.primary { background:var(--accent); border:none; padding:.6rem 1.2rem; color:#fff; border-radius:8px; cursor:pointer; }
    .view{display:none;}
    .streak{font-weight:bold;}
    @media(max-width:600px){ nav{flex-wrap:wrap;gap:.5rem;} .container{padding:1.25rem;} }
  </style>
</head>
<body>
  <nav>
    <span class="brand">StaySlim</span>
    <button class="guest" onclick="showView('login')">Login</button>
    <button class="guest" onclick="showView('signup')">Signup</button>
    <button class="auth" onclick="showView('dashboard')">Dashboard</button>
    <button class="auth" onclick="showView('leaderboard')">Leaderboard</button>
    <button class="auth" onclick="logout()">Logout</button>
    <div id="nav-user" style="margin-left:auto;font-weight:bold;"></div>
  </nav>

  <!-- LOGIN -->
  <section id="login" class="view container">
    <h1>Login</h1>
    <form onsubmit="login(event)">
      <label>Email</label>
      <input id="login-email" type="email" required />
      <label>Password</label>
      <input id="login-password" type="password" required />
      <button class="primary">Login</button>
    </form>
    <p id="login-msg"></p>
  </section>

  <!-- SIGNUP -->
  <section id="signup" class="view container">
    <h1>Signup</h1>
    <form onsubmit="signup(event)">
      <label>Username</label>
      <input id="su-username" type="text" required />
      <label>Email</label>
      <input id="su-email" type="email" required />
      <label>Password</label>
      <input id="su-password" type="password" required />
      <label>Height (cm)</label>
      <input id="su-height" type="number" step="0.1" required />
      <button class="primary">Create account</button>
    </form>
    <p id="signup-msg"></p>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboard" class="view container">
    <h1>Your Dashboard</h1>
    <div id="stats"></div>
    <hr>
    <h2>Daily Log</h2>
    <form onsubmit="addLog(event)">
      <label>Date</label>
      <input id="log-date" type="date" required />
      <label>Weight (kg)</label>
      <input id="log-weight" type="number" step="0.1" required />
      <label>Calories Intake</label>
      <input id="log-cal" type="number" required />
      <button class="primary">Save</button>
    </form>
    <p id="log-msg"></p>
    <hr>
    <h2>Quick Checkâ€‘In</h2>
    <button class="primary" onclick="checkIn()">I worked out today ðŸ’ª</button>
    <p id="checkin-msg"></p>
    <hr>
    <h2>Weight Trend</h2>
    <canvas id="weight-chart" width="800" height="300"></canvas>
  </section>

  <!-- LEADERBOARD -->
  <section id="leaderboard" class="view container">
    <h1>Leaderboard</h1>
    <table style="width:100%;border-collapse:collapse;">
      <thead>
        <tr style="text-align:left;border-bottom:2px solid #e5e7eb;">
          <th>#</th><th>User</th><th>Current Streak</th><th>Max Streak</th>
        </tr>
      </thead>
      <tbody id="lb-body"></tbody>
    </table>
  </section>

<script>
  // ===== simple localStorage helpers =====
  const LS = {
    get: function(key, fallback) { 
      return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); 
    },
    set: function(key, value) { 
      localStorage.setItem(key, JSON.stringify(value)); 
    }
  };

  // ===== data structures =====
  function getUsers() { 
    return LS.get('users', []); 
  }
  
  function saveUsers(list) { 
    LS.set('users', list); 
  }
  
  function current() { 
    return LS.get('current', null); 
  }
  
  function setCurrent(email) { 
    LS.set('current', email); 
    document.getElementById('nav-user').textContent = email || '';
    updateNav();
  }

  // ===== nav auth toggling =====
  function updateNav() {
    const auth = !!current(); 
    document.querySelectorAll('.auth').forEach(b => b.style.display = auth ? 'inline-block' : 'none'); 
    document.querySelectorAll('.guest').forEach(b => b.style.display = auth ? 'none' : 'inline-block');
  }

  // ===== view switching with guard =====
  function showView(id) { 
    if ((id === 'dashboard' || id === 'leaderboard') && !current()) {
      id = 'login';
    }
    document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
    document.getElementById(id).style.display = 'block';
    if (id === 'dashboard') refreshDashboard();
    if (id === 'leaderboard') loadLeaderboard();
  }
  
  // Initialize view and navigation
  updateNav();
  showView('login'); 

  // ===== signup & login =====
  function signup(e) {
    e.preventDefault();
    const username = document.getElementById('su-username').value.trim();
    const email = document.getElementById('su-email').value.trim().toLowerCase();
    const password = document.getElementById('su-password').value;
    const height = parseFloat(document.getElementById('su-height').value);
    
    const users = getUsers();
    if (users.some(u => u.email === email)) {
      document.getElementById('signup-msg').textContent = 'Email already registered';
      return;
    }
    
    users.push({
      username,
      email,
      password,
      height,
      logs: [],
      goals: [],
      checkIns: [],
      streak: { cur: 0, max: 0 }
    });
    
    saveUsers(users);
    document.getElementById('signup-msg').textContent = 'Account created! You may log in.';
    e.target.reset();
  }
  
  function login(e) {
    e.preventDefault();
    const email = document.getElementById('login-email').value.trim().toLowerCase();
    const pw = document.getElementById('login-password').value;
    const user = getUsers().find(u => u.email === email && u.password === pw);
    
    if (!user) {
      document.getElementById('login-msg').textContent = 'Invalid credentials';
      return;
    }
    
    setCurrent(user.email);
    showView('dashboard');
  }
  
  function logout() {
    setCurrent(null);
    showView('login');
  }

  // ===== dashboard =====
  function refreshDashboard() {
    const user = getUsers().find(u => u.email === current());
    if (!user) return;
    
    const last = user.logs[user.logs.length - 1];
    const bmi = last ? (last.weight / ((user.height / 100) ** 2)).toFixed(1) : 'â€”';
    let bmiColor = 'var(--success)';
    const bmiVal = parseFloat(bmi);
    
    if (bmiVal < 18.5) bmiColor = 'var(--warning)';
    else if (bmiVal >= 25) bmiColor = 'var(--danger)';
    
    const statsElem = document.getElementById('stats');
    statsElem.style.borderLeft = `6px solid ${bmiColor}`;
    statsElem.innerHTML = `
      <p><strong>Username:</strong> ${user.username}</p>
      <p><strong>Height:</strong> ${user.height} cm</p>
      <p><strong>Last Weight:</strong> ${last ? last.weight + ' kg (' + last.date + ')' : 'â€”'}</p>
      <p><strong>BMI:</strong> ${bmi}</p>
      <p><strong>Current Streak:</strong> <span class="streak">${user.streak.cur}</span> days</p>
    `;
    
    drawWeightChart(user.logs);
  }
  
  function addLog(e) {
    e.preventDefault();
    const date = document.getElementById('log-date').value;
    const weight = parseFloat(document.getElementById('log-weight').value);
    const cal = parseInt(document.getElementById('log-cal').value);
    
    const users = getUsers();
    const idx = users.findIndex(u => u.email === current());
    if (idx === -1) return;
    
    const user = users[idx];
    user.logs = user.logs.filter(l => l.date !== date);
    user.logs.push({ date, weight, cal });
    user.logs.sort((a, b) => a.date.localeCompare(b.date));
    
    users[idx] = user;
    saveUsers(users);
    
    document.getElementById('log-msg').textContent = 'Saved!';
    e.target.reset();
    refreshDashboard();
  }
  
  function checkIn() {
    const users = getUsers();
    const idx = users.findIndex(u => u.email === current());
    if (idx === -1) return;
    
    const user = users[idx];
    const today = new Date().toISOString().slice(0, 10);
    
    if (user.checkIns.includes(today)) {
      document.getElementById('checkin-msg').textContent = 'Already checkedâ€‘in today!';
      return;
    }
    
    user.checkIns.push(today);
    
    // streak logic
    const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
    user.streak.cur = user.checkIns.includes(yesterday) ? user.streak.cur + 1 : 1;
    user.streak.max = Math.max(user.streak.max, user.streak.cur);
    
    users[idx] = user;
    saveUsers(users);
    
    document.getElementById('checkin-msg').textContent = 'Great job! Streak +1';
    refreshDashboard();
  }

  // ===== leaderboard =====
  function loadLeaderboard() {
    const list = getUsers()
      .map(u => ({ user: u.username, cur: u.streak.cur, max: u.streak.max }))
      .sort((a, b) => b.cur - a.cur || b.max - a.max);
    
    document.getElementById('lb-body').innerHTML = list
      .map((r, i) => `<tr><td>${i+1}</td><td>${r.user}</td><td>${r.cur}</td><td>${r.max}</td></tr>`)
      .join('');
  }

  // ===== basic line chart =====
  function drawWeightChart(logs) {
    const ctx = document.getElementById('weight-chart').getContext('2d');
    ctx.clearRect(0, 0, 800, 300);
    
    if (!logs.length) {
      ctx.font = '16px sans-serif';
      ctx.fillText('No data yet', 10, 30);
      return;
    }
    
    const maxWt = Math.max(...logs.map(l => l.weight));
    const minWt = Math.min(...logs.map(l => l.weight));
    const pad = 10;
    const range = maxWt - minWt || 1;
    const stepX = 800 / (logs.length - 1 || 1);
    
    ctx.strokeStyle = 'var(--accent)';
    ctx.beginPath();
    
    logs.forEach((l, i) => {
      const x = i * stepX;
      const y = 300 - pad - ((l.weight - minWt) / range) * (300 - 2 * pad);
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    
    ctx.stroke();
  }
</script>
</body>
</html>
